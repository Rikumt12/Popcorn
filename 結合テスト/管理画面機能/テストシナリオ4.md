# 機能: 商品表示機能

## テスト対象API:

- `POST /admin/api/login` (管理者ログイン)
- `GET /admin/api/status` (ログイン状態確認)
- `GET /admin/dashboard` (管理画面表示)

## テストデータ準備方針:

- テストの独立性を保つため、各テストケース実行前にセッションをクリアし、データベースの管理者テーブルを初期化する。
- テスト用管理者アカウント: Admin(1, "admin", "admin123", "システム管理者", "admin@simplezakka.com", "ADMIN", true, createdAt, updatedAt, null)
- 無効管理者アカウント: Admin(2, "inactive_admin", "password123", "無効管理者", "inactive@example.com", "ADMIN", false, createdAt, updatedAt, null) 
- セッション管理のテストのため、HTTPセッションクッキーの状態を各テストで確認する 

## テストシナリオ

### No. 4-1

- テストケース名:  管理者ログイン成功
- 前提条件:
  - データベースに管理者が存在する
- 手順:
  1. HTTP GETリクエストを `/admin/api/login` エンドポイントに送信する。
- 入力データ: `{"username": "admin","password": "admin123"}`
- 期待結果:
  1. HTTPステータスコードが `200 OK` であること。
  2. レスポンスボディがJSON形式であること。
  3. JSONオブジェクトの内容が `{"success": true, "message": "ログインしました"}` であること
  4. セッションに admin オブジェクトが格納されていること。

### No. 4-2

- テストケース名: 管理者ログイン画面表示（未ログイン）
- 前提条件:
  - セッションに admin 属性が存在しない。
- 手順:
  1. HTTP GETリクエストを `/admin/login` エンドポイントに送信する。
- 入力データ: なし
- 期待結果:
  1. HTTPステータスコードが `200 OK` であること。
  2. レスポンスとして `admin/login` （HTML）が表示される。

### No. 4-3

- テストケース名: 管理者ダッシュボード表示（ログイン済）
- 前提条件:
  - セッションに管理者情報が格納されている
  - データベースの products テーブルに商品データが存在する
- 手順:
  1. HTTP GETリクエストを `/admin/dashboard` エンドポイントに送信する。
- 入力データ: セッションに管理者情報を含む
- 期待結果:
  1. HTTPステータスコードが `200 OK` であること。
  2. レスポンスとして `admin/dashboard` が返される。
  3. モデルに商品リスト（products）が含まれ、一覧表示に使用される。

### No. 4-4

- テストケース名: 不正な管理者IDでログイン
- 前提条件:
  - データベースに有効な管理者アカウントが存在する 
  - セッションがクリアされている状態
- 手順:
  1. HTTP GETリクエストを `/admin/api/login` エンドポイントに送信する。
- 入力データ:`{ “username": "nonexistent_user",  "password": "admin123"} ` 
- 期待結果:
  1. HTTPステータスコードが `200 OK` であること。
  2. レスポンスボディがJSON形式であること。
  3. JSONオブジェクトの内容が `{  "success": false,  "error": "管理者IDまたはパスワードが間違っています"}  ` であること
  4. セッションに管理者情報が保存されないこと 

### No. 4-5

- テストケース名:不正なパスワードでログイン 
- 前提条件:
  - データベースに有効な管理者アカウントが存在する 
  - セッションがクリアされている状態 
- 手順:
  1. HTTP GETリクエストを `/admin/api/login` エンドポイントに送信する。
- 入力データ: `{  "username": "admin",  "password": "wrong_password"} `
- 期待結果:
  1. HTTPステータスコードが `200 OK` であること。
  2.レスポンスボディがJSON形式であること。
  1. JSONオブジェクトの内容が `{  "success": false,  "error": "管理者IDまたはパスワードが間違っています"} ` であること
  2. セッションに管理者情報が保存されないこと 

### No. 4-6

- テストケース名: 管理者IDが空でログイン
- 前提条件:
  -セッションがクリアされている状態 
- 手順:
  1. HTTP GETリクエストを ` /admin/api/login` エンドポイントに送信する。
- 入力データ:`{  "username": "",  "password": "admin123"} `
- 期待結果:
  1. HTTPステータスコードが `200 OK` であること。
  2. レスポンスボディがJSON形式であること。
  3. JSONオブジェクトの内容が `{  "success": false,  "error": "管理者IDとパスワードを入力してください"}` であること
  4. セッションに管理者情報が保存されないこと
   

### No. 4-7

- テストケース名: パスワードが空でログイン
- 前提条件:
  - セッションがクリアされている状態 
- 手順:
  1. HTTP GETリクエストを `/admin/api/login` エンドポイントに送信する。
- 入力データ:`{  "username": "admin",  "password": ""} `
- 期待結果:
  1. HTTPステータスコードが `200 OK` であること。
  2. レスポンスボディがJSON形式であること。
  3. 返却されるJSONオブジェクトが `ProductDetail` DTOの形式であること。
  4. JSONオブジェクトの内容が `{  "success": false,  "error": "管理者IDとパスワードを入力してください"} ` であること
  5. セッションに管理者情報が保存されないこと 

### No. 4-8

- テストケース名: 無効な管理者アカウントでログイン
- 前提条件:
  - データベースに無効な管理者アカウントが存在する
    - `Username: "inactive_admin", Active: false `
- 手順:
  1. HTTP GETリクエストを ` /admin/api/login` エンドポイントに送信する。
- 入力データ:`{  "username": "inactive_admin",  "password": "password123"}`
- 期待結果:
  1. HTTPステータスコードが `200 OK` であること。
  2. レスポンスボディがJSON形式であること。
  3. JSONオブジェクトの内容が `{  "success": false,  "error": "管理者IDまたはパスワードが間違っています"} ` であること
  4. セッションに管理者情報が保存されないこと

### No. 4-9

- テストケース名: ログイン状態確認処理中のエラー 
- 前提条件:
  - データベース接続エラーまたはセッション処理エラーが発生する環境 
- 手順:
  1. HTTP GETリクエストを `/admin/api/status` エンドポイントに送信する 
  2. セッション取得処理で例外が発生するようにモックを設定 
- 入力データ:なし
- 期待結果:
  1. HTTPステータスコードが `200 OK` であること
  2. レスポンスボディがJSON形式であること
  3. JSONオブジェクトの内容が `{  "loggedIn": false} ` であること

  ### No. 4-10 

- テストケース名: ログイン画面表示（ログイン済）
- 前提条件:
  - セッションに admin オブジェクトが存在する（ログイン済み）
- 手順:
  1. セッションにログイン済みの`admin`を保存する
  2.  HTTP GETリクエストを `/admin/login` エンドポイントに送信する。
- 入力データ:なし
- 期待結果:であること
  1. HTTPレスポンスが `302 Found` であること
  2. Locationヘッダーが `/admin/dashboard`であること
  3. 画面はダッシュボードページに遷移すること

 ### No. 4-11

- テストケース名: ダッシュボード画面表示（未ログイン）
- 前提条件:
  - セッションに `admin` オブジェクトが存在しない（未ログイン）
- 手順:
  1.  空のセッション状態で、HTTP GETリクエストを `/admin/dashboard` エンドポイントに送信する。
- 入力データ:なし
- 期待結果:
  1. HTTPレスポンスが `302 Found` であること
  2. Locationヘッダーが `/admin/login`であること
  3. 画面はログインページに遷移すること
   